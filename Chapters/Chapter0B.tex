%********************************************************************
% Appendix
%*******************************************************
% If problems with the headers: get headings in appendix etc. right
%\markboth{\spacedlowsmallcaps{Appendix}}{\spacedlowsmallcaps{Appendix}}
\chapter{Código}\label{ch:appendix}

\begin{lstlisting}[caption=Modelo discreto de la vía de señalización. Implementación en C]

#include "discreteFunction.h"

int
voltage [72][2] ={
	{0,	1},
	{1,	1},
	{2,	2},
	{3,	2},
	{4,	2},
	{5,	2},
	{9,	2},
	{10,	2},
	{11,	2},
	{12,	2},
	{13,	2},
	{14,	2},
	{18,	2},
	{19,	2},
	{20,	2},
	{21,	2},
	{22,	2},
	{23,	2},
	{27,	0},
	{28,	0},
	{29,	0},
	{30,	1},
	{31,	2},
	{32,	1},
	{36,	2},
	{37,	2},
	{38,	1},
	{39,	2},
	{40,	2},
	{41,	1},
	{45,	2},
	{46,	1},
	{47,	1},
	{48,	2},
	{49,	2},
	{50,	1},
	{81,	0},
	{82,	0},
	{83,	0},
	{84,	2},
	{85,	1},
	{86,	1},
	{90,	2},
	{91,	2},
	{92,	0},
	{93,	2},
	{94,	2},
	{95,	1},
	{99,	2},
	{100,	2},
	{101,	0},
	{102,	2},
	{103,	2},
	{104,	1},
	{108,	0},
	{109,	0},
	{110,	0},
	{111,	0},
	{112,	0},
	{113,	0},
	{117,	2},
	{118,	0},
	{119,	0},
	{120,	1},
	{121,	1},
	{122,	1},
	{126,	1},
	{127,	0},
	{128,	0},
	{129,	1},
	{130,	1},
	{131,	1}
};

int 
calcium [432][2] =
{	
	{0,	0},
	{1,	0},
	{2,	0},
	{3,	0},
	{4,	0},
	{5,	0},
	{9,	0},
	{10,	0},
	{11,	0},
	{12,	0},
	{13,	0},	
	{14,	0},
	{27,	0},
	{28,	0},
	{29,	0},
	{30,	0},
	{31,	0},
	{32,	0},
	{36,	0},
	{37,	0},	
	{38,	0},
	{39,	0},
	{40,	0},
	{41,	0},
	{81,	0},
	{82,	0},
	{83,	0},
	{84,	0},
	{85,	0},	
	{86,	0},
	{90,	0},
	{91,	0},
	{92,	0},
	{93,	0},
	{94,	0},
	{95,	0},
	{108,	0},
	{109,	0},
	{110,	0},
	{111,	0},
	{112,	0},
	{113,	0},
	{117,	0},
	{118,	0},
	{119,	0},
	{120,	0},
	{121,	0},
	{122,	0},
	{162,	0},
	{163,	0},
	{164,	0},
	{165,	0},
	{166,	0},
	{167,	0},
	{171,	0},
	{172,	0},
	{173,	0},
	{174,	0},
	{175,	0},
	{176,	0},
	{189,	0},
	{190,	0},
	{191,	0},
	{192,	0},
	{193,	0},
	{194,	0},
	{198,	0},
	{199,	0},
	{200,	0},
	{201,	0},
	{202,	0},
	{203,	0},
	{243,	0},
	{244,	0},
	{245,	1},
	{246,	0},
	{247,	0},
	{248,	1},
	{252,	0},
	{253,	0},
	{254,	1},
	{255,	0},
	{256,	0},
	{257,	0},
	{270,	1},
	{271,	1},
	{272,	1},
	{273,	1},
	{274,	1},
	{275,	1},
	{279,	1},
	{280,	1},
	{281,	1},
	{282,	0},
	{283,	0},
	{284,	1},
	{324,	0},
	{325,	0},
	{326,	1},
	{327,	0},
	{328,	0},
	{329,	1},
	{333,	0},
	{334,	0},
	{335,	1},
	{336,	0},
	{337,	0},
	{338,	0},
	{351,	1},
	{352,	1},
	{353,	1},
	{354,	1},
	{355,	1},
	{356,	1},
	{360,	1},
	{361,	1},
	{362,	1},
	{363,	0},
	{364,	0},
	{365,	1},
	{405,	2},
	{406,	2},
	{407,	2},
	{408,	2},
	{409,	2},
	{410,	2},
	{414,	2},
	{415,	2},
	{416,	2},
	{417,	2},
	{418,	2},
	{419,	2},
	{432,	2},
	{433,	2},
	{434,	2},
	{435,	2},
	{436,	2},
	{437,	2},
	{441,	2},
	{442,	2},
	{443,	2},
	{444,	2},
	{445,	2},
	{446,	2},
	{729,	0},
	{730,	0},
	{731,	0},
	{732,	0},
	{733,	0},
	{734,	0},
	{738,	0},
	{739,	0},
	{740,	0},
	{741,	0},
	{742,	0},
	{743,	0},
	{756,	0},
	{757,	0},
	{758,	0},
	{759,	0},
	{760,	0},
	{761,	0},
	{765,	0},
	{766,	0},
	{767,	0},
	{768,	0},
	{769,	0},
	{770,	0},
	{810,	0},
	{811,	0},
	{812,	0},
	{813,	0},
	{814,	0},
	{815,	0},
	{819,	0},
	{820,	0},
	{821,	0},
	{822,	0},
	{823,	0},
	{824,	0},
	{837,	0},
	{838,	0},
	{839,	0},
	{840,	0},
	{841,	0},
	{842,	0},
	{846,	0},
	{847,	0},
	{848,	0},
	{849,	0},
	{850,	0},
	{851,	0},
	{891,	0},
	{892,	0},
	{893,	0},
	{894,	0},
	{895,	0},
	{896,	0},
	{900,	0},
	{901,	0},
	{902,	0},
	{903,	0},
	{904,	0},
	{905,	0},
	{918,	0},
	{919,	0},
	{920,	0},
	{921,	0},
	{922,	0},
	{923,	0},
	{927,	0},
	{928,	0},
	{929,	0},
	{930,	0},
	{931,	0},
	{932,	0},
	{972,	1},
	{973,	1},
	{974,	1},
	{975,	0},
	{976,	0},
	{977,	1},
	{981,	0},
	{982,	0},
	{983,	1},
	{984,	0},
	{985,	0},
	{986,	0},
	{999,	1},
	{1000,	1},
	{1001,	1},
	{1002,	1},
	{1003,	1},
	{1004,	1},
	{1008,	1},
	{1009,	1},
	{1010,	1},
	{1011,	0},
	{1012,	0},
	{1013,	1},
	{1053,	1},
	{1054,	1},
	{1055,	1},
	{1056,	0},
	{1057,	0},
	{1058,	1},
	{1062,	0},
	{1063,	0},
	{1064,	1},
	{1065,	0},
	{1066,	0},
	{1067,	0},
	{1080,	1},
	{1081,	1},
	{1082,	1},
	{1083,	1},
	{1084,	1},
	{1085,	1},
	{1089,	1},
	{1090,	1},
	{1091,	1},
	{1092,	0},
	{1093,	0},
	{1094,	1},
	{1134,	2},
	{1135,	2},
	{1136,	2},
	{1137,	2},
	{1138,	2},
	{1139,	2},
	{1143,	2},
	{1144,	2},
	{1145,	2},
	{1146,	2},
	{1147,	2},
	{1148,	2},
	{1161,	2},
	{1162,	2},
	{1163,	2},
	{1164,	2},
	{1165,	2},
	{1166,	2},
	{1170,	2},
	{1171,	2},
	{1172,	2},
	{1173,	2},
	{1174,	2},
	{1175,	2},
	{1458,	0},
	{1459,	0},
	{1460,	0},
	{1461,	0},
	{1462,	0},
	{1463,	0},
	{1467,	0},
	{1468,	0},
	{1469,	0},
	{1470,	0},
	{1471,	0},
	{1472,	0},
	{1485,	0},
	{1486,	0},
	{1487,	0},
	{1488,	0},
	{1489,	0},
	{1490,	0},
	{1494,	0},
	{1495,	0},
	{1496,	0},
	{1497,	0},
	{1498,	0},
	{1499,	0},
	{1539,	0},
	{1540,	0},
	{1541,	0},
	{1542,	0},
	{1543,	0},
	{1544,	0},
	{1548,	0},
	{1549,	0},
	{1550,	0},
	{1551,	0},
	{1552,	0},
	{1553,	0},
	{1566,	0},
	{1567,	0},
	{1568,	0},
	{1569,	0},
	{1570,	0},
	{1571,	0},
	{1575,	0},
	{1576,	0},
	{1577,	0},
	{1578,	0},
	{1579,	0},
	{1580,	0},
	{1620,	0},
	{1621,	0},
	{1622,	0},
	{1623,	0},
	{1624,	0},
	{1625,	0},
	{1629,	0},
	{1630,	0},
	{1631,	0},
	{1632,	0},
	{1633,	0},
	{1634,	0},
	{1647,	0},
	{1648,	0},
	{1649,	0},
	{1650,	0},
	{1651,	0},
	{1652,	0},
	{1656,	0},
	{1657,	0},
	{1658,	0},
	{1659,	0},
	{1660,	0},
	{1661,	0},
	{1701,	1},
	{1702,	1},
	{1703,	1},
	{1704,	1},
	{1705,	1},
	{1706,	1},
	{1710,	1},
	{1711,	1},
	{1712,	1},
	{1713,	1},
	{1714,	1},
	{1715,	1},
	{1728,	2},
	{1729,	2},
	{1730,	1},
	{1731,	1},
	{1732,	1},
	{1733,	1},
	{1737,	1},
	{1738,	1},
	{1739,	1},
	{1740,	1},
	{1741,	1},
	{1742,	1},
	{1782,	1},
	{1783,	1},
	{1784,	1},
	{1785,	1},
	{1786,	1},
	{1787,	1},
	{1791,	1},
	{1792,	1},
	{1793,	1},
	{1794,	1},
	{1795,	1},
	{1796,	1},
	{1809,	1},
	{1810,	1},
	{1811,	1},
	{1812,	1},
	{1813,	1},
	{1814,	1},
	{1818,	1},
	{1819,	1},
	{1820,	1},
	{1821,	1},
	{1822,	1},
	{1823,	1},
	{1863,	2},
	{1864,	2},
	{1865,	2},
	{1866,	2},
	{1867,	2},
	{1868,	2},
	{1872,	1},
	{1873,	1},
	{1874,	1},
	{1875,	1},
	{1876,	1},
	{1877,	1},
	{1890,	1},
	{1891,	1},
	{1892,	1},
	{1893,	1},
	{1894,	1},
	{1895,	1},
	{1899,	1},
	{1900,	1},
	{1901,	1},
	{1902,	1},
	{1903,	1},
	{1904,	1}
};

int compareints (const void * a, const void * b)
{
	return ( *(int*)a - *(int*)b );
}
 
int discreteModel (const int i, const int * st)
{
	// Nodo 26_CaKC es st[19]
	// Nodo 22_PDE es st[21]
	int rvalue = 0;
	int *pItem;
	int key;
	switch (i) {
		case 0: //sr
			rvalue = 1;
			break;
		case 1: //GC
			rvalue = ( (st[0]==1) && (st[11]==0) ) ? 1 : 0;
			break;
		case 2: //cGMP
			rvalue = ( (st[1]==0 && st[21]==0 && st[2]==1) || (st[1]==1 && st[21]==0 && st[2]==0) || (st[1]==1 && st[21]==0 && st[2]==1) ) ? 1 : 0;
			break;
		case 3: //KCNG
			rvalue = (st[2]==1) ? 1 : 0;
			break;
		case 4: //pK
			rvalue = (st[3]==0 && st[19]==0) ? 0 : 1;
			break;
		case 5: //v
			// Transform the key form ternary to decimal representation. Use that key to lookup in the table
			key = (st[4]*81) + (st[20]*27) + (st[15]*9) + (st[12]*3) + st[5];			
			pItem = (int*) bsearch (&key, voltage, 72, sizeof (int *), compareints);
			if (pItem!=NULL)
				rvalue = *(pItem+1);
			else {
				fprintf(stderr, "Bad regulator configuration at node index %d at function %s, file %s, line %d\nAborting...\n", i, __func__, __FILE__, __LINE__);
				fprintf(stderr, "Offending configuration is = %d, %d, %d, %d, %d\n", st[4], st[20], st[15], st[12], st[5] );
			}
			break;
		case 6: //NHE
			rvalue = (st[5]==0 && st[11]==0) ? 1 : 0;
			break;
		case 7: //NCE
			rvalue = ( (st[5]==0 && st[15]==0) || (st[5]==0 && st[15]==1) || (st[5]==0 && st[15]==2) ) ? 1 : 0;
			break;
		case 8: //HCN
			rvalue = ( (st[5]==0 && st[13]==0) || (st[5]==0 && st[13]==1) ) ? 1 : 0;
			break;
		case 9: //AC
			rvalue = ((st[5]==1 && st[11]==0 && st[15]==0) || (st[5]==1 && st[11]==0 && st[15]==1) ||
					  (st[5]==1 && st[11]==1 && st[15]==0) || (st[5]==2 && st[11]==0 && st[15]==0) ||
					  (st[5]==2 && st[11]==0 && st[15]==1) || (st[5]==2 && st[11]==1 && st[15]==0) ||
					  (st[5]==2 && st[11]==1 && st[15]==1) ) ? 0 : 1;
			break;
		case 10: //LVA
			if ((st[5]==0 && st[10]==0) || (st[5]==0 && st[10]==1) || (st[5]==1 && st[10]==1) ){
				rvalue = 1;
			}else if (st[5]==2 && st[10]==1) {
				rvalue = 2;
			}else {
				rvalue = 0;
			}
			break;
		case 11: //uPH
			rvalue = (st[6]==0) ? 0 : 1;
			break;
		case 12: //pNa
			rvalue = (st[8]==0) ? 0 : 1;
			break;
		case 13: //cAMP
			rvalue = ( (st[9]==0 && st[21]==0 && st[13]==1) || (st[9]==1 && st[21]==0 && st[13]==0) || (st[9]==1 && st[21]==0 && st[13]==1) ) ? 1 : 0;
			break;
		case 14: //HVA
			if ( (st[5]==0 && st[14]==0) || (st[5]==0 && st[14]==1) ) {
				rvalue = 1;
			}else if ((st[5]==0 && st[14]==2) || (st[5]==1 && st[14]==0) || (st[5]==2 && st[14]==0)) {
				rvalue = 0;
			}else {
				rvalue = 2;
			}
			break;
		case 15: //pCa
			key = (st[15]*729) + (st[0]*243) + (st[10]*81) + (st[18]*27) + (st[7]*9) + (st[16]*3) + st[14];
			pItem = (int*) bsearch (&key, calcium, 432, sizeof (int *), compareints);
			if (pItem!=NULL)
				rvalue = *(pItem+1);
			else
				fprintf(stderr, "Bad regulator configuration at node index %d at function %s, file %s, line %d\nAborting...\n", i, __func__, __FILE__, __LINE__);
			break;
		case 16: //CaP
			rvalue = (st[15]==0) ? 0 : 1;
			break;
		case 17: //CaCC
			rvalue = (st[15]==0) ? 0 : 1;
			break;
		case 18: //cAMPCC
			rvalue = (st[13]==0) ? 0 : 1;
			break;
		case 19: //CaKC
			rvalue = ( (st[15]==1 && st[5]==2) || (st[15]==2 && st[5]==2) ) ? 1 : 0;
			break;
		case 20: //pCl
			rvalue = (st[17]==0) ? 0 : 1;
			break;
		case 21: //PDE
			rvalue = (st[2]==0 && st[13]==0) ? 0 : 1;
			break;
		default:
			fprintf(stderr, "Bad node index %d at function %s, file %s, line %d\nAborting...\n", i, __func__, __FILE__, __LINE__);
			break;
	}
	return rvalue;

\end{lstlisting}

%\begin{table}
%    \myfloatalign
%  \begin{tabularx}{\textwidth}{Xll} \toprule
%    \tableheadline{labitur bonorum pri no} & \tableheadline{que vista}
%    & \tableheadline{human} \\ \midrule
%    fastidii ea ius & germano &  demonstratea \\
%    suscipit instructior & titulo & personas \\
%    %postulant quo & westeuropee & sanctificatec \\
%    \midrule
%    quaestio philosophia & facto & demonstrated \\
%    %autem vulputate ex & parola & romanic \\
%    %usu mucius iisque & studio & sanctificatef \\
%    \bottomrule
%  \end{tabularx}
%  \caption[Autem usu id]{Autem usu id.}
%  \label{tab:moreexample}
%\end{table}
%
%Ei solet nemore consectetuer nam. Ad eam porro impetus, te choro omnes
%evertitur mel. Molestie conclusionemque vel at, no qui omittam
%expetenda efficiendi. Eu quo nobis offendit, verterem scriptorem ne
%vix.
%
%  
%\begin{lstlisting}[float,caption=A floating example]
%for i:=maxint to 0 do
%begin
%{ do nothing }
%end;
%\end{lstlisting}